Migrations giúp cho việc quản lý lịch sử thay đổi cấu trúc bảng (schema) trong database
Setup migrations:
- bao gồm có : type (loại db), host, port, username, password, database, các entities, migartions

export const AppDataSource = new DataSource({
    type: "mysql",
    host: process.env.DB_HOST,
    port: Number(process.env.DB_PORT),
    username: process.env.DB_USER,
    password: process.env.DB_PASSWORD,
    database: process.env.DB_NAME,
    entities:['dist/**/*.entity.ts'],
    migrations: ['dist/database/migrations/*js'],
    synchronize: false
})

setup scripts trong package.json
{
  "scripts": {
    "build": "nest build",
    "migration:generate": "pnpm run build && typeorm migration:generate -d dist/database/data-source.js",
    "migration:run": "typeorm migration:run -d dist/database/data-source.js",
    "migration:revert": "typeorm migration:revert -d dist/database/data-source.js"
  }
}

setup db docker
docker-compose.yml
  services:
    db:
      image: mysql:8.0
      container_name: ecommerce-db
      restart: always                  
      env_file:
        - .env
      ports:
        - "3306:3306"
      volumes:
        - mysql-data:/var/lib/mysql

  volumes:
    mysql-data:

setup file env:
  MYSQL_ROOT_PASSWORD=123456789
  MYSQL_DATABASE=ecommerce
  MYSQL_HOST=127.0.0.1
  MYSQL_PORT=3306
  MYSQL_USERNAME=root
  MYSQL_PASSWORD=123456789

run docker compose: $ docker compose up -d

Khởi tại migrations:
  pnpm run migration:generate src/database/migrations/InitTables

run migrations:
  pnpm run migration:run

revert migrations:
  pnpm run migration:revert

sau khi thay đổi entities thì chạy lại migration
  pnpm run build
  pnpm run migration:generate src/database/migrations/"noi dung"
